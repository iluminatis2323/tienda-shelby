<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>TucuShop</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Estilos para el carrito flotante */
    #btnCarrito {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 0 10px var(--highlight);
      z-index: 1001;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }
    #btnCarrito:hover {
      background: var(--highlight);
    }
    #panelCarrito {
      display: none;
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 320px;
      max-height: 400px;
      background: var(--secondary-color);
      color: var(--text-color);
      box-shadow: 0 0 15px var(--highlight);
      border-radius: 8px;
      padding: 15px;
      overflow-y: auto;
      z-index: 1000;
    }
    #panelCarrito h3 {
      margin-top: 0;
      text-align: center;
      color: var(--highlight);
    }
    #cerrarPanel {
      position: absolute;
      top: 8px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 22px;
      color: var(--highlight);
      cursor: pointer;
    }
    #listaCarrito {
      list-style: none;
      padding-left: 0;
      max-height: 230px;
      overflow-y: auto;
      margin-bottom: 10px;
    }
    #listaCarrito li {
      margin-bottom: 8px;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      flex-wrap: wrap;
    }
    #listaCarrito li span {
      flex: 1 1 auto;
      min-width: 0;
    }
    #listaCarrito li button {
      font-size: 14px;
      padding: 2px 8px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      transition: opacity 0.2s;
      flex: 0 0 auto;
    }
    .btn-cantidad {
      background: #00cc99;
      color: white;
    }
    .btn-cantidad:hover {
      opacity: 0.8;
    }
    .btn-quitar {
      background: #ff4444;
      color: white;
    }
    .btn-quitar:hover {
      opacity: 0.8;
    }
    #panelCarrito p strong {
      display: inline-block;
      margin-right: 5px;
    }
    #panelCarrito button[onclick="enviarCarritoWhatsApp()"],
    #panelCarrito button[onclick="simularPago()"] {
      width: 100%;
      margin-top: 5px;
      background: var(--primary-color);
      color: white;
      font-weight: bold;
      padding: 8px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    #panelCarrito button[onclick="enviarCarritoWhatsApp()"]:hover,
    #panelCarrito button[onclick="simularPago()"]:hover {
      background: var(--highlight);
    }
  </style>
</head>
<body>
  <button class="toggle-tema" onclick="alternarTema()">🌗 Modo Claro/Oscuro</button>
  <h1>🛍️🛍️ TucuShop</h1>

  <!-- 🗣️ Reseñas de usuarios -->
  <div class="reseñas" id="reseñas">
    <h2>🗣️ Opiniones de nuestros usuarios</h2>
    <ul>
      <li>⭐️⭐️⭐️⭐️⭐️ “La aplicación es excelente para ofrecer mis productos, muy intuitiva.” – Carla (comerciante)</li>
      <li>⭐️⭐️⭐️⭐️ “Funciona muy bien, aunque se me trabó una vez, igual recomiendo.” – Pablo (vendedor)</li>
      <li>⭐️⭐️⭐️⭐️⭐️ “Gracias a TucuShop, empecé a vender mis manualidades sin pagar comisiones.” – Florencia</li>
      <li>⭐️⭐️⭐️ “Está buena pero estaría genial poder agregar más fotos por producto.” – Juan</li>
      <li>⭐️⭐️⭐️⭐️⭐️ “Me encantó, fácil de usar y me conectó con muchos compradores.” – Nati</li>
    </ul>
    <p style="text-align:center; margin-top: 10px;">
      <strong>📢 Esta app está pensada para comerciantes pequeños, feriantes, emprendedores y servicios locales.</strong>
    </p>
  </div>

  <!-- 🔍 Filtros -->
  <div class="filtros">
    <input type="text" id="busqueda" placeholder="Buscar productos..." oninput="filtrarProductos()" />
    <select id="categoria" onchange="filtrarProductos()">
      <option value="">Todas las categorías</option>
      <option value="prestamos">💸 Préstamos personales</option>
      <option value="celulares">📱 Celulares y accesorios</option>
      <option value="notebooks">💻 Notebooks y tecnología</option>
      <option value="electro">🛏️ Electrodomésticos y muebles</option>
      <option value="hogar">🪑 Hogar</option>
      <option value="utiles">🎒 Útiles escolares</option>
      <option value="herramientas">💰 Herramientas</option>
    </select>
  </div>

  <!-- Botón flotante para abrir/cerrar carrito -->
  <button id="btnCarrito" title="Abrir carrito">🛒 <span id="contadorCarrito" style="font-weight:bold; font-size:14px; margin-left:4px;">0</span></button>

  <!-- Panel flotante del carrito -->
  <div id="panelCarrito" aria-label="Carrito de compras" role="dialog" aria-modal="true" tabindex="-1">
    <button id="cerrarPanel" aria-label="Cerrar carrito">×</button>
    <h3>🛒 Tu carrito</h3>
    <ul id="listaCarrito"></ul>
    <p><strong>Total:</strong> $<span id="totalCarrito">0</span></p>
    <button onclick="enviarCarritoWhatsApp()">📲 Solicitar carrito por WhatsApp</button>
    <button onclick="simularPago()" style="margin-top:10px;">💳 Simular Pago QR</button>
  </div>

  <!-- 🛍️ Productos -->
  <div class="productos grid" id="productos"></div>

  <!-- 🔔 Notificación flotante -->
  <div id="notificacion" style="display:none;"></div>

  <!-- 🧠 Scripts -->
  <script src="helpers.js"></script>
  <script src="tema.js"></script>

  <!-- 🌐 Scripts modulares -->
  <script type="module">
    import { agregarAlCarrito, cargarCarrito, cambiarCantidad, quitarDelCarrito, actualizarCarrito, carrito } from './tienda.cmds/carrito.js';
    import { mostrarProductos, filtrarProductos } from './tienda.cmds/productos.js';
    import { enviarCarritoWhatsApp } from './tienda.cmds/whatsapp.js';
    import { simularPago } from './tienda.cmds/simulador.js';

    let productos = [];

    // Exponer funciones necesarias
    window.agregarAlCarrito = agregarAlCarrito;
    window.enviarCarritoWhatsApp = enviarCarritoWhatsApp;
    window.simularPago = simularPago;
    window.cambiarCantidad = cambiarCantidad;
    window.quitarDelCarrito = quitarDelCarrito;

    // Filtro corregido
    function filtrarYMostrar() {
      filtrarProductos(productos, agregarAlCarrito);
    }
    window.filtrarProductos = filtrarYMostrar;

    // Carrito UI
    const btnCarrito = document.getElementById('btnCarrito');
    const panelCarrito = document.getElementById('panelCarrito');
    const cerrarPanel = document.getElementById('cerrarPanel');
    const contadorCarrito = document.getElementById('contadorCarrito');

    btnCarrito.addEventListener('click', () => {
      panelCarrito.style.display = panelCarrito.style.display === 'block' ? 'none' : 'block';
      btnCarrito.title = panelCarrito.style.display === 'block' ? "Cerrar carrito" : "Abrir carrito";
    });

    cerrarPanel.addEventListener('click', () => {
      panelCarrito.style.display = 'none';
      btnCarrito.title = "Abrir carrito";
    });

    function actualizarContador() {
      const totalCantidad = carrito.reduce((acc, item) => acc + item.cantidad, 0);
      contadorCarrito.textContent = totalCantidad;
    }

    const actualizarCarritoOriginal = actualizarCarrito;
    actualizarCarrito = () => {
      actualizarCarritoOriginal();
      actualizarContador();
    };
    window.actualizarCarrito = actualizarCarrito;

    // Carga inicial
    window.onload = async () => {
      try {
        const res = await fetch('https://tienda-shelby.onrender.com/productos');
        productos = await res.json();
        window.productos = productos;
        console.log("📦 Productos cargados:", productos);
        mostrarProductos(productos, agregarAlCarrito);
        cargarCarrito();
        actualizarContador();
      } catch (err) {
        alert("❌ No se pudieron cargar los productos.");
        console.error(err);
      }
    };
  </script>
</body>
</html>











